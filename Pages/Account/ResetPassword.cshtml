@page
@model Barangay.Pages.Account.ResetPasswordModel
@{
    ViewData["Title"] = "Reset Password";
}

<div class="container py-4">
    <div class="login-form-container">
        <h2 class="text-center welcome-header">
            <i class="fas fa-lock"></i> Reset Password <i class="fas fa-arrow-right arrow-icon"></i>
        </h2>
        
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i>
                @TempData["SuccessMessage"]
            </div>
        }
        
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle me-2"></i>
                @TempData["ErrorMessage"]
            </div>
        }
        
        <form method="post" id="resetPasswordForm" class="login-form">
            <div asp-validation-summary="ModelOnly" class="text-danger validation-summary"></div>
            
            <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i>
                Code verified! Please enter your new password below.
            </div>
            
            <div class="form-group">
                <label asp-for="Input.NewPassword" class="form-label">New Password <span class="required">*</span></label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-lock"></i>
                    </span>
                    <input asp-for="Input.NewPassword" class="form-control" type="password" id="newPassword" aria-label="New password input" required aria-required="true" />
                    <button class="btn btn-outline-secondary toggle-password" type="button" id="toggleNewPassword" tabindex="0" aria-label="Toggle new password visibility">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="invalid-feedback" id="newPasswordError">New password is required</div>
                <span asp-validation-for="Input.NewPassword" class="text-danger error-message"></span>
                <small class="form-text text-muted">
                    Password must be at least 6 characters long and contain at least one uppercase letter, one lowercase letter, and one number.
                </small>
            </div>
            
            <div class="form-group">
                <label asp-for="Input.ConfirmPassword" class="form-label">Confirm New Password <span class="required">*</span></label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-lock"></i>
                    </span>
                    <input asp-for="Input.ConfirmPassword" class="form-control" type="password" id="confirmPassword" aria-label="Confirm password input" required aria-required="true" />
                    <button class="btn btn-outline-secondary toggle-password" type="button" id="toggleConfirmPassword" tabindex="0" aria-label="Toggle confirm password visibility">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="invalid-feedback" id="confirmPasswordError">Please confirm your new password</div>
                <span asp-validation-for="Input.ConfirmPassword" class="text-danger error-message"></span>
            </div>
            
            <div class="form-group">
                <label asp-for="Input.IdentityVerification" class="form-label">Identity Verification <span class="required">*</span></label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-user-shield"></i>
                    </span>
                    <input asp-for="Input.IdentityVerification" class="form-control" placeholder="Enter your full name to verify identity" aria-label="Identity verification input" required aria-required="true" />
                </div>
                <div class="invalid-feedback" id="identityError">Please enter your full name for verification</div>
                <span asp-validation-for="Input.IdentityVerification" class="text-danger error-message"></span>
                <small class="form-text text-muted">
                    Enter your full name as registered in the system to verify your identity.
                </small>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary w-100 login-button" id="resetPasswordButton">
                    <span class="login-button-content">
                        <i class="fas fa-save me-2"></i> Reset Password
                    </span>
                    <span class="login-button-spinner d-none">
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        Resetting...
                    </span>
                </button>
            </div>
            
            <div class="text-center mt-3">
                <div>
                    <span class="text-dark">Remember your password?</span> 
                    <a asp-page="./Login" class="register-link">
                        <strong>Back to Login</strong>
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Password visibility toggle
        document.getElementById('toggleNewPassword').addEventListener('click', function() {
            const passwordField = document.getElementById('newPassword');
            const icon = this.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const passwordField = document.getElementById('confirmPassword');
            const icon = this.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        // Password confirmation validation
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            
            if (confirmPassword && newPassword !== confirmPassword) {
                this.setCustomValidity('Passwords do not match');
            } else {
                this.setCustomValidity('');
            }
        });

        // Form submission
        document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
            const button = document.getElementById('resetPasswordButton');
            const content = button.querySelector('.login-button-content');
            const spinner = button.querySelector('.login-button-spinner');
            
            // Show loading state
            button.disabled = true;
            content.classList.add('d-none');
            spinner.classList.remove('d-none');
        });
    </script>
}