@page
@model Barangay.Pages.Admin.NCDFormManagementModel
@{
    ViewData["Title"] = "NCD Form Management";
    Layout = "_AdminLayout";
}

<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: 1px solid rgba(0, 0, 0, 0.125);
    }
    
    .card-header {
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    }
    
    .img-thumbnail {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
    }
    
    .btn-group .btn {
        margin-right: 0.25rem;
    }
    
    .btn-group .btn:last-child {
        margin-right: 0;
    }
    
    .alert {
        border-radius: 0.375rem;
    }
    
    .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .form-select:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .modal-xl {
        max-width: 90%;
    }
    
    .modal-body {
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .form-check-input:checked {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    
    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2"><i class="fas fa-file-medical-alt me-2"></i>NCD Risk Assessment Form Management</h1>
            </div>
            <p class="text-muted mb-4">Manage and upload NCD Risk Assessment Form images for admin use only</p>
        </div>
    </div>

        <div class="content-section">
            <!-- Upload Section -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-upload me-2"></i>Upload New Form Image</h5>
                </div>
                <div class="card-body">
                    <form id="uploadForm" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="imageFile" class="form-label">Select Image File</label>
                                    <input class="form-control" type="file" id="imageFile" accept="image/jpeg,image/png" required>
                                    <div class="form-text">Max file size: 5MB. Accepted formats: JPG, PNG</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="pageNumber" class="form-label">Page Number</label>
                                    <select class="form-select" id="pageNumber" required>
                                        <option value="">-- Select Page --</option>
                                        <option value="1">Page 1 - Primary Information</option>
                                        <option value="2">Page 2 - Risk Assessment</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description (Optional)</label>
                                    <input type="text" class="form-control" id="description" placeholder="Brief description">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-primary w-100" id="uploadBtn">
                                        <i class="fas fa-upload me-1"></i>Upload
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    <!-- Image Preview -->
                    <div id="imagePreview" class="mt-3" style="display: none;">
                        <h6>Image Preview:</h6>
                        <img id="previewImg" class="img-fluid border rounded" style="max-height: 300px;">
                    </div>
                    
                    <!-- Status Messages -->
                    <div id="uploadStatus" class="mt-3"></div>
                </div>
            </div>


            <!-- Uploaded Images Management -->
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-images me-2"></i>Uploaded Images Management</h5>
                </div>
                <div class="card-body">
                    @if (Model.UploadedImages.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Preview</th>
                                        <th>Page</th>
                                        <th>Upload Date</th>
                                        <th>File Size</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var image in Model.UploadedImages)
                                    {
                                        <tr>
                                            <td>
                                                <img src="@image.FilePath" alt="Form Image" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">
                                            </td>
                                            <td>
                                                <span class="badge bg-secondary">Page @image.PageNumber</span>
                                            </td>
                                            <td>@image.UploadDate.ToString("MMM dd, yyyy HH:mm")</td>
                                            <td>@(image.FileSize / 1024) KB</td>
                                            <td>
                                                @if (image.IsActive)
                                                {
                                                    <span class="badge bg-success">Active</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Inactive</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <button class="btn btn-sm btn-outline-success" onclick="editFormFromImage('@image.FileName', '@image.PageNumber')">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    @if (!image.IsActive)
                                                    {
                                                        <button class="btn btn-sm btn-outline-primary" onclick="setActiveImage('@image.FileName', '@image.PageNumber')">
                                                            <i class="fas fa-star"></i> Set Active
                                                        </button>
                                                    }
                                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteImage('@image.FileName')">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="fas fa-images fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No uploaded images found</h5>
                            <p class="text-muted">Upload your first NCD form image using the form above.</p>
                        </div>
                    }
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="d-grid">
                                <a href="/Admin/AdminDashboard" class="btn btn-outline-primary">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-grid">
                                <button class="btn btn-outline-info" onclick="refreshPage()">
                                    <i class="fas fa-sync-alt me-2"></i>Refresh Images
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-grid">
                                <button class="btn btn-outline-success" onclick="downloadActiveImages()">
                                    <i class="fas fa-download me-2"></i>Download Active Images
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    setupNCDFormManagement();
});

function setupNCDFormManagement() {
    const fileInput = document.getElementById('imageFile');
    const previewDiv = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const uploadForm = document.getElementById('uploadForm');
    const uploadBtn = document.getElementById('uploadBtn');
    const statusDiv = document.getElementById('uploadStatus');

    // File preview functionality
    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            // Validate file type
            if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                showStatus('Please select a JPG or PNG image file.', 'danger');
                previewDiv.style.display = 'none';
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showStatus('File is too large. Maximum size is 5MB.', 'danger');
                previewDiv.style.display = 'none';
                return;
            }
            
            // Preview the image
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewDiv.style.display = 'block';
                statusDiv.innerHTML = '';
            }
            reader.readAsDataURL(file);
        }
    });

    // Form submission
    uploadForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const file = fileInput.files[0];
        const page = document.getElementById('pageNumber').value;
        const description = document.getElementById('description').value;
        
        if (!file || !page) {
            showStatus('Please select both a file and page number.', 'warning');
            return;
        }
        
        // Create form data
        const formData = new FormData();
        formData.append('file', file);
        formData.append('page', page);
        formData.append('description', description);
        
        // Show loading state
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Uploading...';
        
        // Send to server
        fetch('/Admin/NCDFormManagement?handler=UploadImage', {
            method: 'POST',
            body: formData,
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showStatus(`<i class="fas fa-check-circle me-2"></i>${data.message}`, 'success');
                uploadForm.reset();
                previewDiv.style.display = 'none';
                // Refresh the page to show new image
                setTimeout(() => location.reload(), 1500);
            } else {
                showStatus(`<i class="fas fa-exclamation-circle me-2"></i>${data.message}`, 'danger');
            }
        })
        .catch(error => {
            showStatus('<i class="fas fa-exclamation-circle me-2"></i>Server error occurred. Please try again.', 'danger');
        })
        .finally(() => {
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = '<i class="fas fa-upload me-1"></i>Upload';
        });
    });
}

function setActiveImage(fileName, pageNumber) {
    if (confirm(`Are you sure you want to set this image as the active image for Page ${pageNumber}?`)) {
        const formData = new FormData();
        formData.append('fileName', fileName);
        formData.append('page', pageNumber);
        
        fetch('/Admin/NCDFormManagement?handler=SetActiveImage', {
            method: 'POST',
            body: formData,
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showStatus(`<i class="fas fa-check-circle me-2"></i>${data.message}`, 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                showStatus(`<i class="fas fa-exclamation-circle me-2"></i>${data.message}`, 'danger');
            }
        })
        .catch(error => {
            showStatus('<i class="fas fa-exclamation-circle me-2"></i>Error setting active image.', 'danger');
        });
    }
}

function deleteImage(fileName) {
    if (confirm('Are you sure you want to delete this image? This action cannot be undone.')) {
        const formData = new FormData();
        formData.append('fileName', fileName);
        
        fetch('/Admin/NCDFormManagement?handler=DeleteImage', {
            method: 'POST',
            body: formData,
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showStatus(`<i class="fas fa-check-circle me-2"></i>${data.message}`, 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                showStatus(`<i class="fas fa-exclamation-circle me-2"></i>${data.message}`, 'danger');
            }
        })
        .catch(error => {
            showStatus('<i class="fas fa-exclamation-circle me-2"></i>Error deleting image.', 'danger');
        });
    }
}

function refreshPage() {
    location.reload();
}

function downloadActiveImages() {
    // Create a zip or download both active images
    window.open('/images/forms/ncd-form-page1.jpg', '_blank');
    setTimeout(() => window.open('/images/forms/ncd-form-page2.jpg', '_blank'), 500);
}

function editFormFromImage(fileName, pageNumber) {
    // Show loading modal
    showEditModal(fileName, pageNumber);
    
    // Process the image for OCR
    const formData = new FormData();
    formData.append('fileName', fileName);
    formData.append('pageNumber', pageNumber);
    
    fetch('/Admin/NCDFormManagement?handler=ProcessImageForEdit', {
        method: 'POST',
        body: formData,
        headers: {
            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.isReadable) {
                // Auto-populate form with extracted data
                populateFormWithData(data.extractedData, pageNumber);
                showStatus(`<i class="fas fa-check-circle me-2"></i>Form data extracted successfully! Please review and edit as needed.`, 'success');
            } else {
                // Show manual entry form
                showManualEntryForm(fileName, pageNumber);
                showStatus(`<i class="fas fa-info-circle me-2"></i>Image not readable by system. Please enter data manually.`, 'info');
            }
        } else {
            showStatus(`<i class="fas fa-exclamation-circle me-2"></i>Error processing image: ${data.message}`, 'danger');
        }
    })
    .catch(error => {
        showStatus('<i class="fas fa-exclamation-circle me-2"></i>Error processing image.', 'danger');
    });
}

function showEditModal(fileName, pageNumber) {
    // Create and show modal for editing
    const modalHtml = `
        <div class="modal fade" id="editFormModal" tabindex="-1" aria-labelledby="editFormModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editFormModalLabel">
                            <i class="fas fa-edit me-2"></i>Edit NCD Form - Page ${pageNumber}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Original Image:</h6>
                                <img src="/images/forms/admin/${fileName}" class="img-fluid border rounded" alt="Original Form">
                            </div>
                            <div class="col-md-6">
                                <div id="formEditArea">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Processing image...</span>
                                        </div>
                                        <p class="mt-2">Processing image for data extraction...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveFormData" style="display: none;">
                            <i class="fas fa-save me-1"></i>Save Form Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('editFormModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('editFormModal'));
    modal.show();
    
    // Add event listener for save button
    document.getElementById('saveFormData').addEventListener('click', function() {
        saveFormData(fileName, pageNumber);
    });
}

function populateFormWithData(data, pageNumber) {
    const formEditArea = document.getElementById('formEditArea');
    
    if (pageNumber === '1') {
        formEditArea.innerHTML = generatePage1Form(data);
    } else if (pageNumber === '2') {
        formEditArea.innerHTML = generatePage2Form(data);
    }
    
    // Show save button
    document.getElementById('saveFormData').style.display = 'block';
}

function showManualEntryForm(fileName, pageNumber) {
    const formEditArea = document.getElementById('formEditArea');
    
    if (pageNumber === '1') {
        formEditArea.innerHTML = generatePage1Form({});
    } else if (pageNumber === '2') {
        formEditArea.innerHTML = generatePage2Form({});
    }
    
    // Show save button
    document.getElementById('saveFormData').style.display = 'block';
}

function generatePage1Form(data) {
    return `
        <h6>Page 1 - Primary Information</h6>
        <form id="page1Form">
            <!-- Health Facility Information -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Health Facility Information</h6>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Health Facility</label>
                        <input type="text" class="form-control" name="healthFacility" value="${data.healthFacility || 'Baesa Health Center'}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Date of Assessment</label>
                        <input type="date" class="form-control" name="dateOfAssessment" value="${data.dateOfAssessment || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Family No.</label>
                        <input type="text" class="form-control" name="familyNo" value="${data.familyNo || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">ID No.</label>
                        <input type="text" class="form-control" name="idNo" value="${data.idNo || ''}">
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Personal Information</h6>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" name="firstName" value="${data.firstName || ''}">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Middle Name</label>
                        <input type="text" class="form-control" name="middleName" value="${data.middleName || ''}">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" name="lastName" value="${data.lastName || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Contact Number</label>
                        <input type="text" class="form-control" name="telepono" value="${data.telepono || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control" name="address" value="${data.address || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Barangay</label>
                        <input type="text" class="form-control" name="barangay" value="${data.barangay || ''}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Birthday</label>
                        <input type="date" class="form-control" name="birthday" value="${data.birthday || ''}">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Age</label>
                        <input type="number" class="form-control" name="edad" value="${data.edad || ''}">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Gender</label>
                        <select class="form-select" name="kasarian">
                            <option value="">-- Select --</option>
                            <option value="M" ${data.kasarian === 'M' ? 'selected' : ''}>Male</option>
                            <option value="F" ${data.kasarian === 'F' ? 'selected' : ''}>Female</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Religion</label>
                        <input type="text" class="form-control" name="relihiyon" value="${data.relihiyon || ''}">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Civil Status</label>
                        <select class="form-select" name="civilStatus">
                            <option value="">-- Select --</option>
                            <option value="S" ${data.civilStatus === 'S' ? 'selected' : ''}>Single</option>
                            <option value="M" ${data.civilStatus === 'M' ? 'selected' : ''}>Married</option>
                            <option value="W" ${data.civilStatus === 'W' ? 'selected' : ''}>Widow/Widower</option>
                            <option value="D" ${data.civilStatus === 'D' ? 'selected' : ''}>Divorced</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label class="form-label">Occupation</label>
                        <input type="text" class="form-control" name="occupation" value="${data.occupation || ''}">
                    </div>
                </div>
            </div>

            <!-- Part II: Past Medical History -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Part II: Past Medical History</h6>
                    <p class="text-muted">Ikaw ba ay may sumusunod nakaramdaman?</p>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">1.1 Karamdaman</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasDiabetes" id="hasDiabetes" ${data.hasDiabetes ? 'checked' : ''}>
                            <label class="form-check-label" for="hasDiabetes">Diabetes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasHypertension" id="hasHypertension" ${data.hasHypertension ? 'checked' : ''}>
                            <label class="form-check-label" for="hasHypertension">Hypertension</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasCancer" id="hasCancer" ${data.hasCancer ? 'checked' : ''}>
                            <label class="form-check-label" for="hasCancer">Cancer</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasLungDisease" id="hasLungDisease" ${data.hasLungDisease ? 'checked' : ''}>
                            <label class="form-check-label" for="hasLungDisease">Sakit sa baga na hindi nakakahawa</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasCOPD" id="hasCOPD" ${data.hasCOPD ? 'checked' : ''}>
                            <label class="form-check-label" for="hasCOPD">COPD</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasEyeDisease" id="hasEyeDisease" ${data.hasEyeDisease ? 'checked' : ''}>
                            <label class="form-check-label" for="hasEyeDisease">Sakit sa mata</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Cancer Site/Location</label>
                        <input type="text" class="form-control" name="cancerSite" value="${data.cancerSite || ''}" placeholder="Isulat ang site/lugar ng Cancer">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">1.3 Taon Nalaman ang Sakit</label>
                        <input type="text" class="form-control" name="yearDiagnosed" value="${data.yearDiagnosed || ''}" placeholder="Taon Nalaman ang Sakit">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">1.4 Iniinom na Gamot</label>
                        <input type="text" class="form-control" name="medication" value="${data.medication || ''}" placeholder="Isulat ang 'Wala' kung walang iniinom">
                    </div>
                </div>
            </div>

            <!-- Part III: Assessment of Risk Factors -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Part III: Assessment of Risk Factors</h6>
                </div>
                
                <!-- A. Non-Modifiable Risk Factors -->
                <div class="col-md-6">
                    <h6 class="text-secondary">A. Non-Modifiable Risk Factors</h6>
                    <div class="mb-3">
                        <label class="form-label">1. Sakit sa pamilya (first degree relatives)</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasHypertension" id="familyHasHypertension" ${data.familyHasHypertension ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasHypertension">Mataas na presyon</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasHeartDisease" id="familyHasHeartDisease" ${data.familyHasHeartDisease ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasHeartDisease">Sakit sa puso</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasStroke" id="familyHasStroke" ${data.familyHasStroke ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasStroke">Stroke</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasDiabetes" id="familyHasDiabetes" ${data.familyHasDiabetes ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasDiabetes">Diabetes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasCancer" id="familyHasCancer" ${data.familyHasCancer ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasCancer">Kanser</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasKidneyDisease" id="familyHasKidneyDisease" ${data.familyHasKidneyDisease ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasKidneyDisease">Sakit sa bato</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="familyHasOtherDisease" id="familyHasOtherDisease" ${data.familyHasOtherDisease ? 'checked' : ''}>
                            <label class="form-check-label" for="familyHasOtherDisease">Iba pang sakit</label>
                        </div>
                        <input type="text" class="form-control mt-2" name="familyOtherDiseaseDetails" value="${data.familyOtherDiseaseDetails || ''}" placeholder="Isulat ang iba pang sakit">
                    </div>
                </div>

                <!-- B. Modifiable Risk Factors -->
                <div class="col-md-6">
                    <h6 class="text-secondary">B. Modifiable Risk Factors</h6>
                    
                    <!-- B.1 Nutrisyon -->
                    <div class="mb-3">
                        <label class="form-label">B.1 Nutrisyon</label>
                        <div class="mb-2">
                            <label class="form-label">1. Madalas mo bang kainin ang mga sumusunod kada araw?</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsVegetables" id="eatsVegetables" ${data.eatsVegetables ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsVegetables">Gulay</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsFruits" id="eatsFruits" ${data.eatsFruits ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsFruits">Prutas</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsFish" id="eatsFish" ${data.eatsFish ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsFish">Isda</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsMeat" id="eatsMeat" ${data.eatsMeat ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsMeat">Karne</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsProcessedFood" id="eatsProcessedFood" ${data.eatsProcessedFood ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsProcessedFood">Processed food</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">2. Kumakain ka ba ng higit sa 2 beses kada linggo ng:</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsSaltyFood" id="eatsSaltyFood" ${data.eatsSaltyFood ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsSaltyFood">Maalat na pagkain</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsSweetFood" id="eatsSweetFood" ${data.eatsSweetFood ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsSweetFood">Matatamis na pagkain</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="eatsFattyFood" id="eatsFattyFood" ${data.eatsFattyFood ? 'checked' : ''}>
                                        <label class="form-check-label" for="eatsFattyFood">Mamantikang pagkain</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="unhealthyDiet" id="unhealthyDiet" ${data.unhealthyDiet ? 'checked' : ''}>
                                    <label class="form-check-label" for="unhealthyDiet">Unhealthy Diet</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="highSaltIntake" id="highSaltIntake" ${data.highSaltIntake ? 'checked' : ''}>
                                    <label class="form-check-label" for="highSaltIntake">With high salt intake</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- B.2 Alcohol -->
                    <div class="mb-3">
                        <label class="form-label">B.2 Alcohol</label>
                        <div class="mb-2">
                            <label class="form-label">1. Umiinom ka ba ng alak?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="drinksAlcohol" id="drinksAlcoholYes" value="Yes" ${data.drinksAlcohol === 'Yes' ? 'checked' : ''}>
                                <label class="form-check-label" for="drinksAlcoholYes">Oo</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="drinksAlcohol" id="drinksAlcoholNo" value="No" ${data.drinksAlcohol === 'No' ? 'checked' : ''}>
                                <label class="form-check-label" for="drinksAlcoholNo">Hindi</label>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Kung hindi, gaano katagal ka natumigil sa pag-inom?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholStoppedDuration" id="alcoholStoppedLessThan1Year" value="LessThan1Year" ${data.alcoholStoppedDuration === 'LessThan1Year' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcoholStoppedLessThan1Year">Wala pang 1 taon</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholStoppedDuration" id="alcoholStoppedMoreThan1Year" value="MoreThan1Year" ${data.alcoholStoppedDuration === 'MoreThan1Year' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcoholStoppedMoreThan1Year">≥ 1 taon</label>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">2. Anong klase?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="drinksBeer" id="drinksBeer" ${data.drinksBeer ? 'checked' : ''}>
                                <label class="form-check-label" for="drinksBeer">Beer</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="drinksWine" id="drinksWine" ${data.drinksWine ? 'checked' : ''}>
                                <label class="form-check-label" for="drinksWine">Wine</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="drinksHardLiquor" id="drinksHardLiquor" ${data.drinksHardLiquor ? 'checked' : ''}>
                                <label class="form-check-label" for="drinksHardLiquor">Whisky/Gin/Brandy</label>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">3. Gaano karami sa isang araw?</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="beerAmount" id="beer1Bottle" value="1Bottle" ${data.beerAmount === '1Bottle' ? 'checked' : ''}>
                                        <label class="form-check-label" for="beer1Bottle">1 bote (320 ml)</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="beerAmount" id="beer2Bottles" value="2Bottles" ${data.beerAmount === '2Bottles' ? 'checked' : ''}>
                                        <label class="form-check-label" for="beer2Bottles">2 bote (640 ml)</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="beerAmount" id="beer3PlusBottles" value="3PlusBottles" ${data.beerAmount === '3PlusBottles' ? 'checked' : ''}>
                                        <label class="form-check-label" for="beer3PlusBottles">> 3 bote</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">4. Gaano kadalas ka umiinom ng alak sa isang linggo?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholFrequency" id="alcohol1to3Times" value="1to3Times" ${data.alcoholFrequency === '1to3Times' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcohol1to3Times">1-3 beses/linggo</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholFrequency" id="alcoholDaily" value="Daily" ${data.alcoholFrequency === 'Daily' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcoholDaily">Dapat na beses sa isang linggo</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholFrequency" id="alcohol5PlusTimes" value="5PlusTimes" ${data.alcoholFrequency === '5PlusTimes' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcohol5PlusTimes">5 beses o higit sa isang linggo</label>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">5. Sa isang okasyon, ilang bote ng alak ang naiinom mo?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholPerOccasion" id="alcohol4Plus" value="4Plus" ${data.alcoholPerOccasion === '4Plus' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcohol4Plus">≥4</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="alcoholPerOccasion" id="alcohol5Plus" value="5Plus" ${data.alcoholPerOccasion === '5Plus' ? 'checked' : ''}>
                                <label class="form-check-label" for="alcohol5Plus">≥5</label>
                            </div>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="isBingeDrinker" id="isBingeDrinker" ${data.isBingeDrinker ? 'checked' : ''}>
                            <label class="form-check-label" for="isBingeDrinker">Binge Drinker</label>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    `;
}

function generatePage2Form(data) {
    return `
        <h6>Page 2 - Risk Assessment</h6>
        <form id="page2Form">
            <!-- B.3 Exercise -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">B.3 Ehersisyo (Exercise)</h6>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">1. May sapat ka bang ehersisyo?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="hasRegularExercise" id="hasRegularExerciseYes" value="Yes" ${data.hasRegularExercise === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="hasRegularExerciseYes">Mayroon</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="hasRegularExercise" id="hasRegularExerciseNo" value="No" ${data.hasRegularExercise === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="hasRegularExerciseNo">Wala</label>
                        </div>
                        <small class="text-muted">(150 minuto sa loob ng isang linggo na hindi lalampas ng 2 araw na pagitan)</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">2. Anong klaseng ehersisyo ang iyong ginagawa?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="exerciseModerateIntensity" id="exerciseModerateIntensity" ${data.exerciseModerateIntensity ? 'checked' : ''}>
                            <label class="form-check-label" for="exerciseModerateIntensity">Moderate Intensity</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="exerciseVigorousIntensity" id="exerciseVigorousIntensity" ${data.exerciseVigorousIntensity ? 'checked' : ''}>
                            <label class="form-check-label" for="exerciseVigorousIntensity">Vigorous Intensity</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="exerciseCombination" id="exerciseCombination" ${data.exerciseCombination ? 'checked' : ''}>
                            <label class="form-check-label" for="exerciseCombination">Kombinasyon ng dalawa</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B.4 Smoking -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">B.4 Paninigarilyo (Smoking)</h6>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">1. Ikaw ba ay naninigarilyo?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="isSmoker" id="isSmokerYes" value="Yes" ${data.isSmoker === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="isSmokerYes">Oo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="isSmoker" id="isSmokerNo" value="No" ${data.isSmoker === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="isSmokerNo">Hindi</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Oo, Gaano kadami ang sigarilyo sa isang araw?</label>
                        <input type="number" class="form-control" name="smokingSticksPerDay" value="${data.smokingSticksPerDay || ''}" placeholder="Number of sticks kada araw">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Oo, pero tumigil na. Gaano ka na katagal tumigil manigarilyo?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smokingQuitDuration" id="smokingQuitLessThan1Year" value="LessThan1Year" ${data.smokingQuitDuration === 'LessThan1Year' ? 'checked' : ''}>
                            <label class="form-check-label" for="smokingQuitLessThan1Year">Wala pang 1 taon</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smokingQuitDuration" id="smokingQuitMoreThan1Year" value="MoreThan1Year" ${data.smokingQuitDuration === 'MoreThan1Year' ? 'checked' : ''}>
                            <label class="form-check-label" for="smokingQuitMoreThan1Year">≥ 1 taon</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Hindi, pero lantad ka ba sa usok ng sigarilyo?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="exposedToSmoke" id="exposedToSmokeYes" value="Yes" ${data.exposedToSmoke === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="exposedToSmokeYes">Oo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="exposedToSmoke" id="exposedToSmokeNo" value="No" ${data.exposedToSmoke === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="exposedToSmokeNo">Hindi</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">2. Ikaw ba ay naka-100 sticks o higit pa sa panahon ng paninigarilyo?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smoked100Sticks" id="smoked100SticksYes" value="Yes" ${data.smoked100Sticks === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="smoked100SticksYes">Oo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smoked100Sticks" id="smoked100SticksNo" value="No" ${data.smoked100Sticks === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="smoked100SticksNo">Hindi</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B.5 Stress -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">B.5 Stress</h6>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">1. Madalas ka bang ma-stress?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="isStressed" id="isStressedYes" value="Yes" ${data.isStressed === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="isStressedYes">Oo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="isStressed" id="isStressedNo" value="No" ${data.isStressed === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="isStressedNo">Hindi</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">2. Ano o Sino ang dahilan ng iyong stress?</label>
                        <input type="text" class="form-control" name="stressCauses" value="${data.stressCauses || ''}" placeholder="Ano o Sino ang dahilan ng iyong stress">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">3. Naaapektuhan ba ang iyong araw-araw na pamumuhay o paggalaw dahil dito?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="stressAffectsDailyLife" id="stressAffectsDailyLifeYes" value="Yes" ${data.stressAffectsDailyLife === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="stressAffectsDailyLifeYes">Oo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="stressAffectsDailyLife" id="stressAffectsDailyLifeNo" value="No" ${data.stressAffectsDailyLife === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="stressAffectsDailyLifeNo">Hindi</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part IV: Risk Screening -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Part IV: Risk Screening</h6>
                </div>
                
                <!-- 4.1 Anthropometric Measurement -->
                <div class="col-md-6">
                    <h6 class="text-secondary">4.1 Anthropometric Measurement</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Weight</label>
                                <input type="number" step="0.1" class="form-control" name="weight" value="${data.weight || ''}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Height</label>
                                <input type="number" step="0.1" class="form-control" name="height" value="${data.height || ''}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">BMI</label>
                                <input type="number" step="0.1" class="form-control" name="bmi" value="${data.bmi || ''}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Formula: BMI: {Wt(kg)/Ht(cm)/Ht(cm)} x 10,000</label>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Waist</label>
                                <input type="number" step="0.1" class="form-control" name="waist" value="${data.waist || ''}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Hip</label>
                                <input type="number" step="0.1" class="form-control" name="hip" value="${data.hip || ''}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">W/H Ratio</label>
                                <input type="number" step="0.01" class="form-control" name="waistHipRatio" value="${data.waistHipRatio || ''}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bmiUnderweight" id="bmiUnderweight" ${data.bmiUnderweight ? 'checked' : ''}>
                            <label class="form-check-label" for="bmiUnderweight">Underweight (<18.5)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bmiNormal" id="bmiNormal" ${data.bmiNormal ? 'checked' : ''}>
                            <label class="form-check-label" for="bmiNormal">Normal (18.5-22.9)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bmiOverweight" id="bmiOverweight" ${data.bmiOverweight ? 'checked' : ''}>
                            <label class="form-check-label" for="bmiOverweight">Overweight (23-24.9)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bmiObese" id="bmiObese" ${data.bmiObese ? 'checked' : ''}>
                            <label class="form-check-label" for="bmiObese">Obese (>25)</label>
                        </div>
                    </div>
                </div>

                <!-- 4.2 Blood Sugar -->
                <div class="col-md-6">
                    <h6 class="text-secondary">4.2 Blood Sugar</h6>
                    <div class="mb-3">
                        <label class="form-label">Fasting Blood Sugar (CBG)</label>
                        <input type="number" class="form-control" name="fastingBloodSugar" value="${data.fastingBloodSugar || ''}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fasting Blood Sugar Venous Extraction</label>
                        <input type="number" class="form-control" name="fastingBloodSugarVenous" value="${data.fastingBloodSugarVenous || ''}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Random Blood Sugar</label>
                        <input type="number" class="form-control" name="randomBloodSugar" value="${data.randomBloodSugar || ''}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bloodSugarNormal" id="bloodSugarNormal" ${data.bloodSugarNormal ? 'checked' : ''}>
                            <label class="form-check-label" for="bloodSugarNormal">Normal (<100 mg/dL)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bloodSugarImpaired" id="bloodSugarImpaired" ${data.bloodSugarImpaired ? 'checked' : ''}>
                            <label class="form-check-label" for="bloodSugarImpaired">Impaired fasting glucose (100-125 mg/dL)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bloodSugarDM" id="bloodSugarDM" ${data.bloodSugarDM ? 'checked' : ''}>
                            <label class="form-check-label" for="bloodSugarDM">DM (>126 mg/dL)</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Check if clinical symptom is present:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasPolyuria" id="hasPolyuria" ${data.hasPolyuria ? 'checked' : ''}>
                            <label class="form-check-label" for="hasPolyuria">Polyuria</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasPolydipsia" id="hasPolydipsia" ${data.hasPolydipsia ? 'checked' : ''}>
                            <label class="form-check-label" for="hasPolydipsia">Polydipsia</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasPolyphagia" id="hasPolyphagia" ${data.hasPolyphagia ? 'checked' : ''}>
                            <label class="form-check-label" for="hasPolyphagia">Polyphagia</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="hasWeightLoss" id="hasWeightLoss" ${data.hasWeightLoss ? 'checked' : ''}>
                            <label class="form-check-label" for="hasWeightLoss">Weight loss</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4.3 Blood Pressure -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="text-secondary">4.3 Blood Pressure</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Left arm mean BP</label>
                                <input type="text" class="form-control" name="leftArmBP" value="${data.leftArmBP || ''}" placeholder="e.g., 140/80">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Right arm mean BP</label>
                                <input type="text" class="form-control" name="rightArmBP" value="${data.rightArmBP || ''}" placeholder="e.g., 140/80">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Baseline BP</label>
                        <input type="text" class="form-control" name="baselineBP" value="${data.baselineBP || ''}" placeholder="e.g., 140/80">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bpNormal" id="bpNormal" ${data.bpNormal ? 'checked' : ''}>
                            <label class="form-check-label" for="bpNormal">Normal (<120 mmHg/< 80 mmHg)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bpPreHPN" id="bpPreHPN" ${data.bpPreHPN ? 'checked' : ''}>
                            <label class="form-check-label" for="bpPreHPN">Pre-HPN (120-139 mmHg/80-89 mmHg)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bpStage1" id="bpStage1" ${data.bpStage1 ? 'checked' : ''}>
                            <label class="form-check-label" for="bpStage1">Stage 1 (140-159 mmHg/90-99 mmHg)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="bpStage2" id="bpStage2" ${data.bpStage2 ? 'checked' : ''}>
                            <label class="form-check-label" for="bpStage2">Stage 2 (≥160/≥100 mmHg)</label>
                        </div>
                    </div>
                </div>

                <!-- 4.4 Cholesterol Level -->
                <div class="col-md-6">
                    <h6 class="text-secondary">4.4 Cholesterol Level</h6>
                    <div class="mb-3">
                        <label class="form-label">Result</label>
                        <input type="number" class="form-control" name="cholesterolResult" value="${data.cholesterolResult || ''}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="cholesterolNormal" id="cholesterolNormal" ${data.cholesterolNormal ? 'checked' : ''}>
                            <label class="form-check-label" for="cholesterolNormal">Normal (<200 mg/100 ml)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="cholesterolElevatedMaybe" id="cholesterolElevatedMaybe" ${data.cholesterolElevatedMaybe ? 'checked' : ''}>
                            <label class="form-check-label" for="cholesterolElevatedMaybe">Elevated, maybe at risk (200-239/100 ml)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="cholesterolElevatedAtRisk" id="cholesterolElevatedAtRisk" ${data.cholesterolElevatedAtRisk ? 'checked' : ''}>
                            <label class="form-check-label" for="cholesterolElevatedAtRisk">Elevated, at risk (240/100 ml and above)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4.5 Urine Dipstick Test -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="text-secondary">4.5 Urine Dipstick Test</h6>
                    <div class="mb-3">
                        <label class="form-label">Protein</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="urineProtein" id="urineProteinPositive" value="Positive" ${data.urineProtein === 'Positive' ? 'checked' : ''}>
                            <label class="form-check-label" for="urineProteinPositive">(+) urine protein</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="urineProtein" id="urineProteinNegative" value="Negative" ${data.urineProtein === 'Negative' ? 'checked' : ''}>
                            <label class="form-check-label" for="urineProteinNegative">(-) urine protein</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Ketones</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="urineKetones" id="urineKetonesPositive" value="Positive" ${data.urineKetones === 'Positive' ? 'checked' : ''}>
                            <label class="form-check-label" for="urineKetonesPositive">(+) urine ketones</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="urineKetones" id="urineKetonesNegative" value="Negative" ${data.urineKetones === 'Negative' ? 'checked' : ''}>
                            <label class="form-check-label" for="urineKetonesNegative">(-) urine ketones</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4.6 Risk Profile & 4.7 Cancer Screening -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="text-secondary">4.6 Risk Profile (For Doctors Only)</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="riskProfile" id="riskLessThan5" value="LessThan5" ${data.riskProfile === 'LessThan5' ? 'checked' : ''}>
                        <label class="form-check-label" for="riskLessThan5"><5%</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="riskProfile" id="risk5to10" value="5to10" ${data.riskProfile === '5to10' ? 'checked' : ''}>
                        <label class="form-check-label" for="risk5to10">5%-<10%</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="riskProfile" id="risk10to20" value="10to20" ${data.riskProfile === '10to20' ? 'checked' : ''}>
                        <label class="form-check-label" for="risk10to20">10%-<20%</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="riskProfile" id="risk20to30" value="20to30" ${data.riskProfile === '20to30' ? 'checked' : ''}>
                        <label class="form-check-label" for="risk20to30">20%-<30%</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="riskProfile" id="riskMoreThan30" value="MoreThan30" ${data.riskProfile === 'MoreThan30' ? 'checked' : ''}>
                        <label class="form-check-label" for="riskMoreThan30">>30% risk</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <h6 class="text-secondary">4.7 Cancer Screening (Babae na 30 years old and above)</h6>
                    <div class="mb-3">
                        <label class="form-label">1. Ikaw ba ay nai-screen na sa Breast/Cervical Cancer?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cancerScreening" id="cancerScreeningYes" value="Yes" ${data.cancerScreening === 'Yes' ? 'checked' : ''}>
                            <label class="form-check-label" for="cancerScreeningYes">Oo (Ipaalala ang next visit)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cancerScreening" id="cancerScreeningNo" value="No" ${data.cancerScreening === 'No' ? 'checked' : ''}>
                            <label class="form-check-label" for="cancerScreeningNo">Hindi (i-refer)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assessment Information -->
            <div class="row mb-4">
                <div class="col-12">
                    <h6 class="text-primary">Assessment Information</h6>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Interviewed/Assessed by</label>
                        <input type="text" class="form-control" name="interviewedBy" value="${data.interviewedBy || ''}">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Designation</label>
                        <input type="text" class="form-control" name="designation" value="${data.designation || ''}">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control" name="assessmentDate" value="${data.assessmentDate || ''}">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label class="form-label">Signature of Patient</label>
                        <input type="text" class="form-control" name="patientSignature" value="${data.patientSignature || ''}">
                    </div>
                </div>
            </div>
        </form>
    `;
}

function saveFormData(fileName, pageNumber) {
    const formId = pageNumber === '1' ? 'page1Form' : 'page2Form';
    const form = document.getElementById(formId);
    
    if (!form) {
        showStatus('<i class="fas fa-exclamation-circle me-2"></i>Form not found.', 'danger');
        return;
    }
    
    // Collect form data
    const formData = new FormData(form);
    formData.append('fileName', fileName);
    formData.append('pageNumber', pageNumber);
    
    // Show loading state
    const saveBtn = document.getElementById('saveFormData');
    const originalText = saveBtn.innerHTML;
    saveBtn.disabled = true;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Saving...';
    
    // Send to server
    fetch('/Admin/NCDFormManagement?handler=SaveFormData', {
        method: 'POST',
        body: formData,
        headers: {
            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.isUpdate) {
                showStatus(`<i class="fas fa-sync-alt me-2"></i>${data.message}`, 'info');
            } else {
                showStatus(`<i class="fas fa-check-circle me-2"></i>${data.message}`, 'success');
            }
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editFormModal'));
            modal.hide();
        } else {
            showStatus(`<i class="fas fa-exclamation-circle me-2"></i>${data.message}`, 'danger');
        }
    })
    .catch(error => {
        showStatus('<i class="fas fa-exclamation-circle me-2"></i>Error saving form data.', 'danger');
    })
    .finally(() => {
        saveBtn.disabled = false;
        saveBtn.innerHTML = originalText;
    });
}

function showStatus(message, type) {
    const statusDiv = document.getElementById('uploadStatus');
    statusDiv.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>`;
}
</script>

</script>
