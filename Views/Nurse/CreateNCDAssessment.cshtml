@model Barangay.Models.NCDRiskAssessmentViewModel
@{
    ViewData["Title"] = "Create NCD Risk Assessment";
    Layout = "_NurseLayout";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="m-0">
            <i class="fas fa-heartbeat text-primary me-2"></i>
            NCD Risk Assessment
        </h2>
        <a href="/Nurse/AppointmentDetails?id=@Model.AppointmentId" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>
            Back to Appointment
        </a>
    </div>

    @if (!string.IsNullOrEmpty(TempData["StatusMessage"]?.ToString()))
    {
        <div class="alert @(TempData["StatusMessage"].ToString().Contains("Error") ? "alert-danger" : "alert-success") alert-dismissible fade show" role="alert">
            @TempData["StatusMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <form asp-action="CreateNCDAssessment" method="post" id="ncdAssessmentForm">
        <input asp-for="AppointmentId" type="hidden" />
        <input asp-for="UserId" type="hidden" />

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            Patient Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="HealthFacility" class="form-label">Health Facility</label>
                                    <input asp-for="HealthFacility" class="form-control" readonly />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="FamilyNo" class="form-label">Family Number</label>
                                    <input asp-for="FamilyNo" class="form-control" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="AppointmentType" class="form-label">Appointment Type</label>
                                    <select asp-for="AppointmentType" class="form-select">
                                        <option value="General Checkup">General Checkup</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Consultation">Consultation</option>
                                        <option value="Emergency">Emergency</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="FirstName" class="form-label">First Name</label>
                                    <input asp-for="FirstName" class="form-control" />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="MiddleName" class="form-label">Middle Name</label>
                                    <input asp-for="MiddleName" class="form-control" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="LastName" class="form-label">Last Name</label>
                                    <input asp-for="LastName" class="form-control" />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="Edad" class="form-label">Age</label>
                                    <input asp-for="Edad" class="form-control" type="number" min="20" max="120" />
                                    <span asp-validation-for="Edad" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="Kasarian" class="form-label">Gender</label>
                                    <select asp-for="Kasarian" class="form-select">
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="CivilStatus" class="form-label">Civil Status</label>
                                    <select asp-for="CivilStatus" class="form-select">
                                        <option value="">Select Status</option>
                                        <option value="Single">Single</option>
                                        <option value="Married">Married</option>
                                        <option value="Widowed">Widowed</option>
                                        <option value="Divorced">Divorced</option>
                                        <option value="Separated">Separated</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="Relihiyon" class="form-label">Religion</label>
                                    <input asp-for="Relihiyon" class="form-control" />
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Address" class="form-label">Address</label>
                                    <textarea asp-for="Address" class="form-control" rows="2"></textarea>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="Barangay" class="form-label">Barangay</label>
                                    <input asp-for="Barangay" class="form-control" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label asp-for="Telepono" class="form-label">Phone Number</label>
                                    <input asp-for="Telepono" class="form-control" />
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Birthday" class="form-label">Birthday</label>
                                    <input asp-for="Birthday" class="form-control" type="date" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Occupation" class="form-label">Occupation</label>
                                    <input asp-for="Occupation" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medical History Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-stethoscope me-2"></i>
                            Medical History
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">Current Medical Conditions</h6>
                                <div class="form-check mb-2">
                                    <input asp-for="HasDiabetes" class="form-check-input" type="checkbox" />
                                    <label asp-for="HasDiabetes" class="form-check-label">Diabetes</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="HasHypertension" class="form-check-input" type="checkbox" />
                                    <label asp-for="HasHypertension" class="form-check-label">Hypertension</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="HasCancer" class="form-check-input" type="checkbox" id="hasCancer" />
                                    <label asp-for="HasCancer" class="form-check-label">Cancer</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="HasCOPD" class="form-check-input" type="checkbox" />
                                    <label asp-for="HasCOPD" class="form-check-label">COPD</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="HasLungDisease" class="form-check-input" type="checkbox" />
                                    <label asp-for="HasLungDisease" class="form-check-label">Lung Disease</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="HasEyeDisease" class="form-check-input" type="checkbox" />
                                    <label asp-for="HasEyeDisease" class="form-check-label">Eye Disease</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3" id="cancerTypeDiv" style="display: none;">
                                    <label asp-for="CancerType" class="form-label">Cancer Type</label>
                                    <input asp-for="CancerType" class="form-control" placeholder="Specify cancer type" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lifestyle Factors Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-running me-2"></i>
                            Lifestyle Factors
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="SmokingStatus" class="form-label">Smoking Status</label>
                                    <select asp-for="SmokingStatus" class="form-select">
                                        <option value="Non-smoker">Non-smoker</option>
                                        <option value="Current smoker">Current smoker</option>
                                        <option value="Former smoker">Former smoker</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="AlcoholFrequency" class="form-label">Alcohol Frequency</label>
                                    <select asp-for="AlcoholFrequency" class="form-select">
                                        <option value="">Select frequency</option>
                                        <option value="Never">Never</option>
                                        <option value="Occasionally">Occasionally</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Daily">Daily</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="ExerciseDuration" class="form-label">Exercise Duration</label>
                                    <select asp-for="ExerciseDuration" class="form-select">
                                        <option value="">Select duration</option>
                                        <option value="None">None</option>
                                        <option value="Less than 30 min/week">Less than 30 min/week</option>
                                        <option value="30-60 min/week">30-60 min/week</option>
                                        <option value="More than 60 min/week">More than 60 min/week</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input asp-for="HighSaltIntake" class="form-check-input" type="checkbox" />
                                    <label asp-for="HighSaltIntake" class="form-check-label">High Salt Intake</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="AlcoholConsumption" class="form-label">Alcohol Consumption Details</label>
                                    <textarea asp-for="AlcoholConsumption" class="form-control" rows="2" placeholder="Describe alcohol consumption habits"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Family History Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>
                            Family History
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">Family Medical History</h6>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasHypertension" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasHypertension" class="form-check-label">Family Hypertension</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasHeartDisease" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasHeartDisease" class="form-check-label">Family Heart Disease</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasStroke" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasStroke" class="form-check-label">Family Stroke</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasDiabetes" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasDiabetes" class="form-check-label">Family Diabetes</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasCancer" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasCancer" class="form-check-label">Family Cancer</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input asp-for="FamilyHasKidneyDisease" class="form-check-input" type="checkbox" />
                                    <label asp-for="FamilyHasKidneyDisease" class="form-check-label">Family Kidney Disease</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="FamilyOtherDiseaseDetails" class="form-label">Other Family Diseases</label>
                                    <textarea asp-for="FamilyOtherDiseaseDetails" class="form-control" rows="4" placeholder="Describe other family medical conditions"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <button type="submit" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-save me-2"></i>
                            Save Assessment
                        </button>
                        <a href="/Nurse/AppointmentDetails?id=@Model.AppointmentId" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Show/hide cancer type field based on cancer checkbox
            $('#hasCancer').change(function() {
                if ($(this).is(':checked')) {
                    $('#cancerTypeDiv').show();
                } else {
                    $('#cancerTypeDiv').hide();
                    $('#CancerType').val('');
                }
            });

            // Initialize cancer type visibility
            if ($('#hasCancer').is(':checked')) {
                $('#cancerTypeDiv').show();
            }

            // Form validation
            $('#ncdAssessmentForm').on('submit', function(e) {
                var isValid = true;
                var errorMessage = '';

                // Check required fields
                if (!$('#FirstName').val().trim()) {
                    errorMessage += 'First Name is required.\n';
                    isValid = false;
                }
                if (!$('#LastName').val().trim()) {
                    errorMessage += 'Last Name is required.\n';
                    isValid = false;
                }
                if (!$('#Edad').val() || $('#Edad').val() < 20 || $('#Edad').val() > 120) {
                    errorMessage += 'Age must be between 20 and 120.\n';
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('Please fix the following errors:\n\n' + errorMessage);
                }
            });
        });
    </script>
}
